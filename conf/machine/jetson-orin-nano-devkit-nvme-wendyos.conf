
# jetson-orin-nano-devkit-nvme-wendyos.conf
# NVMe boot configuration for Jetson Orin Nano DevKit

MACHINEOVERRIDES =. "jetson-orin-nano-devkit:"

# include upstream base if available
require conf/machine/jetson-orin-nano-devkit-nvme.conf

# AB upgrades & bootloader choices (board-specific)
UBOOT_EXTLINUX = "1"
USE_REDUNDANT_FLASH_LAYOUT_DEFAULT = "1"

MENDER_FEATURES_DISABLE:append = " mender-uboot"
MENDER_EFI_LOADER = ""

# UEFI Capsule Update Configuration
# Disable Secure Boot for development/testing (no signing keys configured)
# When "false": No key enrollment, Secure Boot disabled, unsigned capsules accepted
# Set to "true" for production after implementing proper signing infrastructure
TEGRA_UEFI_USE_SIGNED_FILES = "false"

# NVMe Storage geometry (board-specific)
# Set flash image size to 64GB (automatically sets MENDER_STORAGE_TOTAL_SIZE_MB = 51000)
WENDYOS_FLASH_IMAGE_SIZE = "64GB"
MENDER_STORAGE_DEVICE_BASE = "/dev/nvme0n1p"
MENDER_BOOT_PART = "${MENDER_STORAGE_DEVICE_BASE}11"
MENDER_ROOTFS_PART_A = "${MENDER_STORAGE_DEVICE_BASE}1"
MENDER_ROOTFS_PART_B = "${MENDER_STORAGE_DEVICE_BASE}2"

# IMPORTANT: Use partition 17 for Mender data, NOT partition 15 (UDA)
# UDA (p15) is reserved by NVIDIA and positioned before rootfs partitions,
# preventing expansion. Partition 17 (mender_data, renamed from permanet_user_storage)
# is positioned AFTER APP_b and can expand to fill remaining disk space.
# See docs/partition-layout-fix-plan.md for detailed analysis.
MENDER_DATA_PART_NUMBER = "17"
MENDER_DATA_PART = "${MENDER_STORAGE_DEVICE_BASE}${MENDER_DATA_PART_NUMBER}"

# Initial size - will auto-expand on first boot via mender-grow-data.service
MENDER_DATA_PART_SIZE_MB = "512"

# NVMe boot device configuration
TNSPEC_BOOTDEV = "nvme0n1p1"

# Use NVMe partition layout
PARTITION_LAYOUT_TEMPLATE_DEFAULT = "flash_t234_qspi.xml"
PARTITION_LAYOUT_TEMPLATE_DEFAULT_SUPPORTS_REDUNDANT = "1"
PARTITION_LAYOUT_EXTERNAL_DEFAULT = "flash_l4t_t234_nvme.xml"

# Jetson image formats that are machine/BSP oriented:
IMAGE_FSTYPES:tegra = "tegraflash mender dataimg"
IMAGE_FSTYPES:pn-tegra-minimal-initramfs:tegra = "${INITRAMFS_FSTYPES}"
IMAGE_FSTYPES:pn-tegra-initrd-flash-initramfs:tegra = "${TEGRA_INITRD_FLASH_INITRAMFS_FSTYPES}"

# If you really need it, board param (but consider removing if unused):
EMMC_SIZE = "0"
