# Systemd drop-in for containerd.service
# Limits total memory usage for ALL containers combined to 7.4GB
#
# This prevents device lockup by constraining the total memory that
# containerd and all its child containers can consume together.
#
# Device Memory: ~7.6GB total
# System Reserved: ~200MB for OS (kernel, systemd, etc)
# Containerd+Containers: 7.4GB maximum
# Swap: 4GB available for temporary spikes

[Service]
# Hard limit: Kill containerd if ALL containers together exceed 7.4GB
MemoryMax=7.4G

# Soft limit: Start throttling at 6.5GB to avoid hitting hard limit
MemoryHigh=6.5G

# Memory accounting must be enabled
MemoryAccounting=yes
