# USB Network Performance Tuning
# Optimizes kernel parameters for better USB gadget network throughput

# Increase maximum socket buffer sizes (16MB)
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216

# Increase default socket buffer sizes (2MB)
net.core.rmem_default = 2097152
net.core.wmem_default = 2097152

# TCP buffer sizes: min, default, max (in bytes)
# min: 4KB, default: 87KB, max: 16MB
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 87380 16777216

# Increase network device backlog queue length
net.core.netdev_max_backlog = 5000

# Enable TCP window scaling for better throughput on high-latency links
net.ipv4.tcp_window_scaling = 1

# Use BBR congestion control for better performance over variable latency
# Falls back to cubic if BBR is not available
net.ipv4.tcp_congestion_control = bbr

# Enable TCP fast open for reduced connection latency
net.ipv4.tcp_fastopen = 3

# Increase max number of packets queued on the INPUT side
net.core.netdev_budget = 600

# Reduce TIME_WAIT timeout to free up connections faster
net.ipv4.tcp_fin_timeout = 15

# Enable TCP timestamps for better RTT estimation
net.ipv4.tcp_timestamps = 1

# Enable selective acknowledgments for better recovery from packet loss
net.ipv4.tcp_sack = 1
